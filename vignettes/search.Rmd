---
title: "Searching"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette describes how to search anystyle references against the
solr indexes for each library.

Before running a search against a collection, you need to create the collection 
by following the instructions in the 'Indexing' vignette.


# Convert Anystyle Extracted Citation to Search Query
-----------
To convert a reference (in anystyle's output format) into a query use
the `search_constuct_query` function.

The fields from the anystyle data that are used in the query are "author",
"title", "publication", "date", and "doi". The rest are discarded, these include
genre, page number, editor, etc. It seems unlikely that the discarded components
would help to distinguish between results and noise.

In addition there is some preprocessing that gets applied.   
- The date field is converted into a 4 digit year. 
- Authors is converted into a string concatenating all the parsed authors
- Special characters such as '"', '\r', '\n', and '\t' are removed from the string
- Only the first value in fields that sometimes have multiple is kept (sometimes
  a citation has multiple publishers, or titles in anystyle)

The query is constructed by applying the appropriate search field to each 
term.

```{r}
library(citationSearch)
anystyle_entry = anystyle[1, ]
query_string = search_construct_query(anystyle_entry)
query_string
```

# Searching Against a Collection

To search against a collection you can construct a custom search using solrium 
as a guide: https://docs.ropensci.org/solrium/articles/search.html 
OR using the `search_collection` function from this package.

```{r}
results = search_collection("treesearch", query_string)
results
```

`search_collection` expects the name of the collection you want
to search against (one of "treesearch", "nfsl", "blm"), and a query string,
probably generated from `search_construct_query`. Otherwise read through
Lucene's documentation for how to generate a query and use that.
